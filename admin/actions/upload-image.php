<?php
defined('lidmarshop123456') or header("Location: ../index.php");  
$error_img = array();

if($_FILES['upload_image']['error'] > 0)
{
 //в зависимости от номера ошибки выводим соответствующее сообщение
 switch ($_FILES['upload_image']['error'])
 {
 case 1: $error_img[] =  '????? ???? ????? ??? ? ??? ?????????? ? UPLOAD_MAX_FILE_SIZE'; break;
 case 2: $error_img[] =  '????? ???? ????? ??? ? ??? ?????????? ? MAX_FILE_SIZE'; break;
 case 3: $error_img[] =  '?? ???????? ?????? ?????'; break;
 case 4: $error_img[] =  '?? ???????? ?????? ?????'; break;
 case 6: $error_img[] =  '?? ???????? ?????? ?????'; break;
 case 7: $error_img[] =  '?? ???????? ?????? ?????'; break;
 case 8: $error_img[] =  '?? ???????? ?????? ?????'; break;
 }

}else
{
//проверяем расширения
if($_FILES['upload_image']['type'] == 'image/jpeg' || $_FILES['upload_image']['type'] == 'image/jpg' || $_FILES['upload_image']['type'] == 'image/png')
{ 

$imgext = strtolower(preg_replace("#.+\.([a-z]+)$#i", "$1", $_FILES['upload_image']['name']));

    //папка для загрузки
$uploaddir = '../uploads_images/';
//новое сгенерированное имя файла
$newfilename = '-'.$id.rand(1,100000).rand(1,10000).'.'.$imgext;
//путь к файлу (папка.файл)
$uploadfile = $uploaddir.$newfilename;
 
//загружаем файл move_uploaded_file
if (move_uploaded_file($_FILES['upload_image']['tmp_name'], $uploadfile))
{

  $update = mysql_query("UPDATE table_products SET image='$newfilename' WHERE products_id = '$id'",$link);   

}
else
{
 $error_img[] =  "?? ???????? ?????? ?????";    
}
 

    
}else
{
 $error_img[] =  '??????????? ????????????? jpeg, jpg, png';
}
 

}


?>